<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Reviews - Dagupan Milk Tea House</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }

        body {
            margin: 0;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        header button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }

        header button:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            vertical-align: top;
        }

        th {
            background: rgba(255, 255, 255, 0.2);
            color: #ffcc70;
        }

        .media-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            margin: 2px;
        }

        .action-btn {
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-right: 5px;
            transition: 0.3s;
        }

        .approve-btn {
            background: #22c55e;
        }

        .approve-btn:hover {
            background: #16a34a;
        }

        .delete-btn {
            background: #ef4444;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .no-reviews {
            text-align: center;
            margin-top: 30px;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .media-group {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
    </style>
</head>

<body>

    <header>
        <button onclick="window.location.href='admin.html'">← Back</button>
        <h1>Manage Customer Reviews</h1>
    </header>

    <table id="reviewTable">
        <thead>
            <tr>
                <th>Product</th>
                <th>Full Name</th>
                <th>Rating</th>
                <th>Comment</th>
                <th>Media</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <p id="noReviews" class="no-reviews" style="display:none;">No reviews available.</p>

    <script>
        const reviewsTable = document.querySelector('#reviewTable tbody');
        const noReviewsMsg = document.getElementById('noReviews');

        // Load reviews from localStorage
        let reviews = JSON.parse(localStorage.getItem('reviews')) || [];

        function saveReviews() {
            localStorage.setItem('reviews', JSON.stringify(reviews));
        }

        function renderReviews() {
            reviewsTable.innerHTML = '';

            if (reviews.length === 0) {
                noReviewsMsg.style.display = 'block';
                return;
            }
            noReviewsMsg.style.display = 'none';

            reviews.forEach((review, index) => {
                const row = document.createElement('tr');

                // Media (images/videos)
                const mediaHTML = review.media && review.media.length > 0
                    ? `<div class="media-group">${review.media.map(m =>
                        m.startsWith("data:video")
                            ? `<video src="${m}" class="media-thumb" controls></video>`
                            : `<img src="${m}" class="media-thumb">`
                    ).join('')}</div>`
                    : '—';

                // Pull full name from checkout or fallback
                const fullName = review.fullName || review.checkoutName || review.user || "—";

                row.innerHTML = `
          <td>${review.productName || '—'}</td>
          <td>${fullName}</td>
          <td>${'⭐'.repeat(review.rating || 0)}</td>
          <td>${review.text || 'No comment'}</td>
          <td>${mediaHTML}</td>
          <td>${review.status || 'Pending'}</td>
          <td>
            <button class="action-btn approve-btn" onclick="approveReview(${index})">Approve</button>
            <button class="action-btn delete-btn" onclick="deleteReview(${index})">Delete</button>
          </td>
        `;
                reviewsTable.appendChild(row);
            });
        }

        function approveReview(index) {
            reviews[index].status = "Approved";
            saveReviews();
            renderReviews();
            alert("✅ Review approved!");
        }

        function deleteReview(index) {
            if (confirm("Are you sure you want to delete this review?")) {
                reviews.splice(index, 1);
                saveReviews();
                renderReviews();
            }
        }

        renderReviews();
    </script>

</body>

</html>