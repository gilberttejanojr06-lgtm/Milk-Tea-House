<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Orders - Dagupan Milk Tea House</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; font-family: "Poppins", sans-serif; margin: 0; padding: 0; }
body { display: flex; min-height: 100vh; background: #f3f4f6; color: #333; }

/* Sidebar */
.sidebar {
  width: 250px;
  background: linear-gradient(180deg, #6366f1, #8b5cf6);
  color: white;
  padding: 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.sidebar h2 { text-align: center; margin-bottom: 30px; }
.nav-links a {
  display: block;
  color: white;
  text-decoration: none;
  padding: 12px 15px;
  border-radius: 10px;
  transition: 0.3s;
  margin-bottom: 10px;
}
.nav-links a:hover, .nav-links a.active { background: rgba(255,255,255,0.2); }
.logout-btn {
  background: #ef4444;
  border: none;
  color: white;
  padding: 12px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  width: 100%;
  transition: 0.3s;
}
.logout-btn:hover { background: #dc2626; }

/* Main content */
.main { flex: 1; padding: 20px; }
.topbar {
  background: white;
  padding: 15px 25px;
  border-radius: 12px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.topbar h1 { font-size: 20px; color: #333; }

.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}
.filter-bar button {
  background: white;
  border: 2px solid #6366f1;
  color: #6366f1;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}
.filter-bar button:hover { background: #6366f1; color: white; }
.filter-bar .active { background: #6366f1; color: white; }

.orders-container {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
}
.order-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  transition: 0.3s;
}
.order-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.order-item {
  display: flex;
  justify-content: space-between;
  border-bottom: 1px dashed #e5e7eb;
  padding: 8px 0;
  font-size: 14px;
}
.order-item:last-child { border-bottom: none; }

.order-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}

.status-select {
  padding: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-family: "Poppins", sans-serif;
}
.action-buttons {
  display: flex;
  gap: 8px;
}
.save-btn, .delete-btn {
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}
.save-btn { background: #22c55e; }
.save-btn:hover { background: #16a34a; }
.delete-btn { background: #ef4444; }
.delete-btn:hover { background: #dc2626; }

.no-orders {
  text-align: center;
  opacity: 0.7;
  margin-top: 20px;
}

@media (max-width:768px) {
  .sidebar { display: none; }
  .main { width: 100%; }
}
</style>
</head>
<body>

<div class="sidebar">
  <div>
    <h2>Admin Panel</h2>
    <div class="nav-links">
      <a href="admin.html">üè† Dashboard</a>
      <a href="manage-order.html" class="active">üßã Orders</a>
      <a href="users.html">üë§ Users</a>
      <a href="product.html">üçµ Products</a>
      <a href="manage-review.html">üìù Review</a>
      <a href="#">‚öôÔ∏è Settings</a>
    </div>
  </div>
  <button class="logout-btn" onclick="window.location.href='admin-login.html'">Logout</button>
</div>

<div class="main">
  <div class="topbar">
    <h1>Manage Orders</h1>
    <span id="datetime"></span>
  </div>

  <div class="filter-bar">
    <button class="active" onclick="filterOrders('All')">All</button>
    <button onclick="filterOrders('To Pay')">To Pay</button>
    <button onclick="filterOrders('To Ship')">To Ship</button>
    <button onclick="filterOrders('To Receive')">To Receive</button>
    <button onclick="filterOrders('To Review')">To Review</button>
    <button onclick="filterOrders('Completed')">Completed</button>
  </div>

  <div class="orders-container" id="ordersContainer"></div>
</div>

<script>
function updateDateTime() {
  document.getElementById('datetime').textContent = new Date().toLocaleString();
}
setInterval(updateDateTime, 1000);
updateDateTime();

function getAllOrders() {
  const allOrders = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.endsWith("_orders")) {
      const orders = JSON.parse(localStorage.getItem(key)) || [];
      allOrders.push(...orders);
    }
  }
  return allOrders;
}

let currentFilter = "All";
const ordersContainer = document.getElementById("ordersContainer");

function renderOrders() {
  const allOrders = getAllOrders();
  const filtered = currentFilter === "All" ? allOrders : allOrders.filter(o => o.status === currentFilter);
  ordersContainer.innerHTML = "";

  if (filtered.length === 0) {
    ordersContainer.innerHTML = `<p class="no-orders">No orders found for "${currentFilter}".</p>`;
    return;
  }

  filtered.forEach((order, index) => {
    const div = document.createElement("div");
    div.classList.add("order-card");

    const itemsHTML = order.items.map(item => `
      <div class="order-item">
        <div style="display:flex;align-items:center;gap:10px;">
          <img src="${item.image || 'https://via.placeholder.com/50'}" alt="${item.name}" style="width:40px;height:40px;border-radius:5px;object-fit:cover;">
          <span>${item.name} √ó ${item.quantity}</span>
        </div>
        <span>‚Ç±${(item.price * item.quantity).toFixed(2)}</span>
      </div>
    `).join("");

    const totalPrice = order.items.reduce((sum,i)=>sum+(i.price*i.quantity),0).toFixed(2);

    div.innerHTML = `
      <p><strong>Date:</strong> ${order.date}</p>
      ${itemsHTML}
      <div class="order-footer">
        <div>
          <strong>Status:</strong>
          <select id="status-${index}" class="status-select">
            ${["To Pay","To Ship","To Receive","To Review","Completed"].map(status => `
              <option value="${status}" ${order.status===status?"selected":""}>${status}</option>
            `).join("")}
          </select>
        </div>
        <div>
          <strong>Total:</strong> ‚Ç±${totalPrice}
        </div>
      </div>
      <div class="action-buttons">
        <button class="save-btn" onclick="updateOrder(${index})">üíæ Save</button>
        <button class="delete-btn" onclick="deleteOrder(${index})">üóëÔ∏è Delete</button>
      </div>
    `;

    ordersContainer.appendChild(div);
  });
}

function filterOrders(status) {
  currentFilter = status;
  document.querySelectorAll(".filter-bar button").forEach(btn => btn.classList.remove("active"));
  const activeBtn = Array.from(document.querySelectorAll(".filter-bar button"))
    .find(b => b.textContent.trim() === (status === "All" ? "All" : status));
  if (activeBtn) activeBtn.classList.add("active");
  renderOrders();
}

function updateOrder(index) {
  const allOrders = getAllOrders();
  const filtered = currentFilter === "All" ? allOrders : allOrders.filter(o => o.status === currentFilter);
  const order = filtered[index];
  const newStatus = document.getElementById(`status-${index}`).value;

  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.endsWith("_orders")) {
      const userOrders = JSON.parse(localStorage.getItem(key)) || [];
      const matchIndex = userOrders.findIndex(o => o.date === order.date);
      if (matchIndex >= 0) {
        userOrders[matchIndex].status = newStatus;
        localStorage.setItem(key, JSON.stringify(userOrders));
        break;
      }
    }
  }

  alert(`‚úÖ Order status updated to "${newStatus}".`);
  renderOrders();
}

function deleteOrder(index) {
  if (!confirm("üóëÔ∏è Are you sure you want to delete this order?")) return;

  const allOrders = getAllOrders();
  const filtered = currentFilter === "All" ? allOrders : allOrders.filter(o => o.status === currentFilter);
  const order = filtered[index];

  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.endsWith("_orders")) {
      const userOrders = JSON.parse(localStorage.getItem(key)) || [];
      const matchIndex = userOrders.findIndex(o => o.date === order.date);
      if (matchIndex >= 0) {
        userOrders.splice(matchIndex, 1);
        localStorage.setItem(key, JSON.stringify(userOrders));
        break;
      }
    }
  }

  alert("üóëÔ∏è Order deleted successfully!");
  renderOrders();
}

renderOrders();
</script>
</body>
</html>
