<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Dagupan Milk Tea House</title>
<style>
* { box-sizing:border-box; font-family:"Poppins",sans-serif; margin:0; padding:0; }
body { display:flex; min-height:100vh; background:#f3f4f6; color:#333; }
.sidebar { width:250px; background:linear-gradient(180deg,#6366f1,#8b5cf6); color:white; padding:20px; display:flex; flex-direction:column; justify-content:space-between; }
.sidebar h2 { text-align:center; margin-bottom:30px; }
.nav-links a { display:block; color:white; text-decoration:none; padding:12px 15px; border-radius:10px; transition:0.3s; margin-bottom:10px; }
.nav-links a:hover, .nav-links a.active { background: rgba(255,255,255,0.2); }
.logout-btn { background:#ef4444; border:none; color:white; padding:12px; border-radius:10px; font-weight:600; cursor:pointer; width:100%; transition:0.3s; }
.logout-btn:hover { background:#dc2626; }
.main { flex:1; padding:20px; }
.topbar { background:white; padding:15px 25px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; display:flex; justify-content:space-between; align-items:center; }
.topbar h1 { font-size:20px; color:#333; }
.stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
.card { background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.05); text-align:center; transition:0.3s; }
.card:hover { transform:translateY(-5px); box-shadow:0 5px 15px rgba(0,0,0,0.1); }
.card h3 { color:#6366f1; margin-bottom:10px; }
.card p { font-size:22px; font-weight:600; }

.monthly-table { max-width:500px; margin:auto; background:white; border-radius:12px; padding:20px; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
.monthly-table h2 { text-align:center; margin-bottom:15px; color:#6366f1; }
.monthly-table table { width:100%; border-collapse:collapse; }
.monthly-table th, .monthly-table td { padding:10px 15px; }
.monthly-table th { background:#f3f4f6; }
.monthly-table td:first-child { text-align:left; }
.monthly-table td:last-child { text-align:right; }

@media (max-width:768px) { .sidebar { display:none; } .main { width:100%; } }
</style>
</head>
<body>

<div class="sidebar">
  <div>
    <h2>Admin Panel</h2>
    <div class="nav-links">
      <a href="admin.html" class="active">üè† Dashboard</a>
      <a href="manage-order.html">üßã Orders</a>
      <a href="users.html">üë§ Users</a>
      <a href="product.html">üçµ Products</a>
      <a href="manage-review.html">üìù Review</a>
      <a href="#">‚öôÔ∏è Settings</a>
    </div>
  </div>
  <button class="logout-btn" onclick="window.location.href='admin-login.html'">Logout</button>
</div>

<div class="main">
  <div class="topbar">
    <h1>Welcome, Admin</h1>
    <span id="datetime"></span>
  </div>

  <div class="stats">
    <div class="card"><h3>Total Orders</h3><p id="totalOrders">0</p></div>
    <div class="card"><h3>Pending Orders</h3><p id="pendingOrders">0</p></div>
    <div class="card"><h3>Total Users</h3><p id="totalUsers">0</p></div>
    <div class="card"><h3>Total Revenue</h3><p id="totalRevenue">‚Ç±0.00</p></div>
  </div>

  <div class="monthly-table">
    <h2>üìä Monthly Revenue</h2>
    <table>
      <thead>
        <tr>
          <th>Month</th>
          <th>Revenue</th>
        </tr>
      </thead>
      <tbody id="monthlyRevenueTable"></tbody>
    </table>
  </div>
</div>

<script>
function updateDateTime(){
  document.getElementById('datetime').textContent=new Date().toLocaleString();
}
setInterval(updateDateTime,1000);
updateDateTime();

function loadDashboardStats(){
  const users = JSON.parse(localStorage.getItem("users")) || [];
  document.getElementById("totalUsers").textContent = users.length;

  let allOrders = [];
  for(let i=0;i<localStorage.length;i++){
    const key = localStorage.key(i);
    if(key.endsWith("_orders")){
      allOrders = allOrders.concat(JSON.parse(localStorage.getItem(key)) || []);
    }
  }
  document.getElementById("totalOrders").textContent = allOrders.length;
  document.getElementById("pendingOrders").textContent = allOrders.filter(o=>o.status!=="Completed").length;

  const totalRevenue = allOrders.reduce((sum,o)=>sum+o.items.reduce((s,i)=>s+i.price*i.quantity,0),0);
  document.getElementById("totalRevenue").textContent = `‚Ç±${totalRevenue.toFixed(2)}`;

  // Monthly revenue
  const monthlyRevenue = {};
  allOrders.forEach(order => {
    const date = new Date(order.date);
    const month = date.toLocaleString('default', { month: 'long', year: 'numeric' });
    const revenue = order.items.reduce((s,i)=>s+i.price*i.quantity,0);
    if(!monthlyRevenue[month]) monthlyRevenue[month] = 0;
    monthlyRevenue[month] += revenue;
  });

  const tbody = document.getElementById("monthlyRevenueTable");
  tbody.innerHTML = "";
  Object.keys(monthlyRevenue).sort((a,b)=>{
    return new Date(a) - new Date(b);
  }).forEach(month=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${month}</td><td>‚Ç±${monthlyRevenue[month].toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
}

loadDashboardStats();
window.addEventListener('storage', loadDashboardStats);
setInterval(loadDashboardStats,5000);
</script>

</body>
</html>
