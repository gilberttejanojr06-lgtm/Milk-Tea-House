<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details - Dagupan Milk Tea House</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #8b5cf6, #6366f1);
      color: white; min-height: 100vh;
    }
    header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 15px 25px;
      background: rgba(255,255,255,0.15);
      position: sticky; top: 0;
    }
    header button {
      background: rgba(255,255,255,0.2);
      border: none; color: white;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }
    header button:hover { background: rgba(255,255,255,0.4); }

    .product-container {
      display: flex; flex-wrap: wrap;
      gap: 30px; justify-content: center;
      padding: 40px 20px;
    }
    .product-img {
      flex: 1 1 300px;
      text-align: center;
    }
    .product-img img {
      width: 300px; height: 300px;
      object-fit: cover;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .product-info {
      flex: 1 1 300px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
    }
    .product-info h2 { margin: 0; font-weight: 700; }
    .product-info p { margin: 10px 0; line-height: 1.6; }
    .price { font-size: 1.3rem; font-weight: 600; color: #ffcc70; }

    .btn {
      background: white;
      color: #6366f1;
      padding: 10px 18px;
      border: none; border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { background: #e5e7ff; }

    .reviews {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      margin: 20px;
      border-radius: 15px;
    }
    .review {
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .review strong { color: #ffcc70; font-size: 1.1rem; }
    .review img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      margin-top: 10px;
      border: 2px solid rgba(255,255,255,0.3);
      transition: transform 0.3s;
    }
    .review img:hover { transform: scale(1.05); }
    .review p {
      margin-top: 5px;
      color: #f0f0f0;
    }
    .no-reviews { text-align: center; opacity: 0.8; }

    @media(max-width: 768px){
      .product-container { flex-direction: column; align-items: center; }
      .product-info { width: 90%; }
    }
  </style>
</head>
<body>

  <header>
    <button onclick="window.location.href='menu.html'">‚Üê Back</button>
    <h1>Product Details</h1>
  </header>

  <div class="product-container">
    <div class="product-img">
      <img id="productImage" src="" alt="Milk Tea">
    </div>
    <div class="product-info">
      <h2 id="productName"></h2>
      <p id="productDescription"></p>
      <p class="price">‚Ç±<span id="productPrice"></span></p>
      <button class="btn" onclick="addToCart()">Add to Cart</button>
    </div>
  </div>

  <div class="reviews">
    <h3>üìù Customer Reviews</h3>
    <div id="reviewsList" class="reviews-list"></div>
  </div>

  <script>
    const product = JSON.parse(localStorage.getItem("selectedProduct"));
    if (!product) {
      alert("No product selected. Redirecting to menu...");
      window.location.href = "menu.html";
    }

    document.getElementById("productImage").src = product.image;
    document.getElementById("productName").textContent = product.name;
    document.getElementById("productDescription").textContent = product.desc;
    document.getElementById("productPrice").textContent = product.price;

    // Sample reviews
    const reviews = JSON.parse(localStorage.getItem("reviews")) || [
      { productName: "Classic Milk Tea", user: "Jane D.", rating: 5, text: "Perfect blend of sweetness!", image: "images/review1.jpg" },
      { productName: "Classic Milk Tea", user: "Mark L.", rating: 4, text: "Really good taste, pearls are chewy.", image: "images/review2.jpg" },
      { productName: "Okinawa Milk Tea", user: "Anna G.", rating: 5, text: "Love the brown sugar flavor!", image: "images/review3.jpg" }
    ];
    localStorage.setItem("reviews", JSON.stringify(reviews));

    function renderReviews() {
      const container = document.getElementById("reviewsList");
      const allReviews = JSON.parse(localStorage.getItem("reviews")) || [];
      const productReviews = allReviews.filter(r => r.productName === product.name);

      if(productReviews.length === 0){
        container.innerHTML = `<p class="no-reviews">No reviews yet for this product.</p>`;
        return;
      }

      container.innerHTML = productReviews.map(r => `
        <div class="review">
          <strong>${r.user}</strong> ‚≠ê ${"‚òÖ".repeat(r.rating)}<br>
          <p>${r.text}</p>
          ${r.image ? `<img src="${r.image}" alt="Review Image">` : ""}
        </div>
      `).join("");
    }

    function addToCart() {
      const loggedInUser = localStorage.getItem("loggedInUser");
      if (!loggedInUser) {
        alert("Please log in first.");
        window.location.href = "index.html"; // redirect to login page
        return;
      }

      const userCartKey = `${loggedInUser}_cart`;
      const cart = JSON.parse(localStorage.getItem(userCartKey)) || [];
      const existing = cart.find(item => item.name === product.name);

      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }

      localStorage.setItem(userCartKey, JSON.stringify(cart));
      alert(`${product.name} has been added to your cart.`);
    }

    renderReviews();
  </script>

</body>
</html>
